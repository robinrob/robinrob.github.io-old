<!DOCTYPE html>
<html lang='en'>
  <body>
    <p>
      <head>
  <script>
    var host = "yoursite.com";
    if ((host == window.location.host) && (window.location.protocol != "https:"))
      window.location.protocol = "https";
  </script>
  <meta charset='utf-8'>
  <meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
  <meta content='IE=edge' http-equiv='X-UA-Compatible'>
  <meta content='width=device-width, initial-scale=1' name='viewport'>
  <meta content='utf-8' name='content-type'>
  <meta content='Experienced freelance software developer designing and building custom web applications and integrations using modern cloud technologies and frameworks.
' name='description'>
  <meta content='Freelance developer, Edinburgh, mobile, web, AngularJS, PhoneGap, SEO, Heroku, AWS, Google Apps, JavaScript, Force.com, Salesforce' name='keywords'>
  <title>Visualising a Git submodule tree</title>
  <!-- CSS -->
  <link href='css/styles.css' rel='stylesheet'>
  <link href='img/favicon.gif' rel='icon' type='image/gif'>
  <link href=' { { site.url } }{ { page.url } }' rel='canonical'>
</head>

    </p>
    <body>
  <header class='intro-header' style="background-image: url('')">
    <div class='container'>
      <div class='row'>
        <div class='col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1'>
          <div class='site-heading'>
            <h1>Visualising a Git submodule tree</h1>
            <hr class='small'>
            <span class='subheading'>A method for organising personal repositories</span>
          </div>
        </div>
      </div>
    </div>
  </header>
</body>

    <!-- Navigation -->
<nav class='navbar navbar-default navbar-custom navbar-fixed-top'>
  <div class='container-fluid'>
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class='navbar-header page-scroll'>
      <button class='navbar-toggle' data-target='#bs-example-navbar-collapse-1' data-toggle='collapse' type='button'>
        <span class='sr-only'>Toggle navigation</span>
        <span class='icon-bar'></span>
        <span class='icon-bar'></span>
        <span class='icon-bar'></span>
      </button>
      <a class='navbar-brand' href='/index.html'>Robin Smith IO</a>
    </div>
    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class='collapse navbar-collapse' id='bs-example-navbar-collapse-1'>
      <ul class='nav navbar-nav navbar-right'>
        <li>
        </li>
      </ul>
    </div>
  </div>
</nav>

    <div class='container'>
      <div class='col-xs-1'></div>
      <div class='col-xs-10'>
        <p>All of my source code lives in a tree of Git submodules, extending downwards from my ‘master’ source repository, which is simply named <code>robin</code>. This giant tree of code includes everything i have ever written - both practice code and project code.</p>

<p>The reasons that i keep up this practice are described in this post: <a href="htp://mrrobinsmith.com/blogposts/blah">Living in the cloud</a></p>

<p>I recently became frustrated with the command <code>git submodule foreach --recursive</code>, which allows one to execute a given shell command for each submodule, recursing down the submodule tree. My frustration was with the inability to recurse <em>upwards</em> using this command. The reason i wanted this functionality was so that i could save all of my code changes using a single command, adding committing and pushing changes in each repo, from the lowest submodule to the topmost parent. I had devised a system for the repositories that i commonly used, which involved creating a <code>submodules.csv</code> file in each of these directories. It was simple to use some Ruby code inside of a Rake task to parse these files, but in the end i never ended up using the ‘save all’ functionality - it just wasn’t practical, and my <code>submodules.csv</code> files quickly became neglected.</p>

<p>Whilst doing a fresh clone of my code on another laptop, i decided that i wanted to be able to do <code>git checkout master</code> on each cloned repository directly after cloning, since on a few occasions i ended up making, committing and pushing changes on a <code>detached</code> commit from the previous recursive clone. However this checkout ended up leaving a ‘dirty-commit’ message when running <code>git status</code> in parent repositories. I had some idea of resolving this which again required an upwards recurse up my repository tree.</p>

<p>Finally i more recently got to wondering ‘just how many submodules do i have in my tree?’ And ‘what would this tree look like?’ - if i were to make a graphical representation of it. I realised that i simply wanted the power to perform any arbitrarily-complex action for each submodule, whether or not i was recursing upwards or downwards. Since i am also currently enjoying learning the Ruby language, i finally found a justification for writing my own <code>.gitconfig</code>-style parser, in order to parse the <code>.gitmodules</code> files which are necessarily maintained in a perfect state of correctness. Once this was complete, i could work on code for manipulating those submodules and <code>.gitconfig</code> files. It was a fun project for a Sunday-afternoon, followed by minor tweaks and a few feature additions over the next week. It was highly enjoyable as i wanted to apply my test-driven-development technique in Ruby. The result was that i was able to come up with what i believe to be a nice, simple interface for <code>.gitconfig</code>-file manipulations, backed-up by robust, well-tested code.</p>

<h2 id="what-it-looks-like">What it looks like</h2>

<screenshot showing="" code="" tree="">
<div class="thumbnail">
  <a href="/img/rake_each_sub.png"><img src="/img/rake_each_sub.png" alt="Screenshot showing drawn code tree" /></a>
  <div class="caption">
    `rake each_sub['echo, quiet']`
  </div>
</div>


The 'drawing' of my code tree is simply a special case usage of my `rake each_sub` command, where i am just running the shell command `echo`, with my rake task in `quiet` mode - which suppresses terminal output from the command.


&lt;screenshot showing rake .gitmodules sort&gt;
<div class="thumbnail">
 <a href="/img/rake_sort_sub.png"><img src="/img/rake_sort_sub.png" alt="Screenshot showing drawn code tree" /></a>
  <div class="caption">
      `rake sort_sub`
  </div>
</div>

Using my code library, it was exceedingly simple to add a `sort!` method to my `GitConfigFile` model, which delegates to a `GitConfigBlockCollection` class to perform the sort.


## The code
Below is a list of classes that i used to implement this functionality:

-  `GitConfigBlock` - represents a single section of `.gitconfig` file

-  `GitConfigBlockCollection` - stores a list of `GitConfigBlock` instances and provides collection-manipulation methods like `sort!`, which sorts the collection alphabetically by name, where `name` would be `ruby` in the following .gitmodules block:
`[submodule "ruby"]
path = ruby
url = git@bitbucket.org:robinrob/ruby.git
branch = master`

-  `GitConfigFile` -
</screenshot>

      </div>
    </div>
    <!-- Footer -->
<footer>
  <div class='container'>
    <div class='row'>
      <div class='col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1'>
        <ul class='list-inline text-center'>
          <li>
            <a href='//twitter.com/rsmith_io' target='_blank'>
              <span class='fa-stack fa-lg'>
                <i class='fa fa-circle fa-stack-2x'></i>
                <i class='fa fa-twitter fa-stack-1x fa-inverse'></i>
              </span>
            </a>
          </li>
          <li>
            <a href='//github.com/robinrob' target='_blank'>
              <span class='fa-stack fa-lg'>
                <i class='fa fa-circle fa-stack-2x'></i>
                <i class='fa fa-github fa-stack-1x fa-inverse'></i>
              </span>
            </a>
          </li>
          <li>
            <a href='//www.linkedin.com/in/rsmithio' target='_blank'>
              <span class='fa-stack fa-lg'>
                <i class='fa fa-circle fa-stack-2x'></i>
                <i class='fa fa-linkedin fa-stack-1x fa-inverse'></i>
              </span>
            </a>
          </li>
        </ul>
        <p class='copyright text-muted'>Copyright © Robin Smith IO 2015</p>
      </div>
    </div>
  </div>
</footer>
<!-- jQuery Core Javascript -->
<script src='js/scripts.js'></script>

  </body>
</html>
